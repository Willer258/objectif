<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DonnÃ©es JSON depuis Google Sheets</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>

    <h1 style="-top: 5rem;">
      Allez la team on peut y arriver
    </h1>

    <p>
      Ensemble, nous pouvons atteindre nos objectifs ! Chaque effort que nous faisons nous rapproche de la rÃ©ussite. Remplissons nos jauges dâ€™objectif avec dÃ©termination et enthousiasme. Gardons notre motivation haute et avanÃ§ons unis vers le succÃ¨s. Nous avons tout ce quâ€™il faut pour y arriver, alors continuons sur cette lancÃ©e ! ðŸ’ªðŸš€
    </p>

    <h1 style="position: absolute; top:20% ; left:0% ; right:0" id="countdown"> </h1>
   
    <div
      style="
        display: flex;
        align-items: center;
        justify-content: space-around;
        padding: 3rem;
        min-height: 100vh;
      "
    >

      <div style="display: flex; flex-direction: column; align-items: center">
        <h1><span id="caWAFA">0</span> / 200,000,000 FCFA</h1>
        <div class="container">
          <div class="water_wave"></div>
        </div>

        <h1>Objectif CA WAFA</h1>
      </div>

      <div style="display: flex; flex-direction: column; align-items: center">
        <h1><span id="caWiASSUR">0</span> / 2,214,588,154 FCFA</h1>
        <div class="container">
          <div class="water_wave2"></div>
        </div>

        <h1>Objectif CA WiASSUR</h1>
      </div>
    </div>

    <script>
      const apiUrl =
        "https://script.google.com/macros/s/AKfycbzRy4KzJ6AvL8mnOcUi9_qbPACSG-XjS-upBAWOfB-I0wZNsP7ul_rnAj08b7_zGa2A2A/exec"; // Remplace par l'URL de ton application Web

      const dynamicStyleSheet = document.createElement("style");
      document.head.appendChild(dynamicStyleSheet);

      // Fonction pour remplir les donnÃ©es et les niveaux de progression
      function remplirProgression(data) {
      

        const ObjectifWafa = 200000000;
        const ObjectifWiassur = 2214588154;
        // Calcule les hauteurs en pourcentage
        const pourcentageWafa = (data.totalWafa * 100) / ObjectifWafa;
        const pourcentageWiassur = (data.totalWiassur * 100) / ObjectifWiassur;

        createDynamicKeyframes("dynamicWave1", pourcentageWafa);
        createDynamicKeyframes("dynamicWave2", pourcentageWiassur);

        // Mise Ã  jour des montants dans les Ã©lÃ©ments HTML
        document.getElementById(
          "caWAFA"
        ).textContent = `${data.totalWafa.toLocaleString()} FCFA`;
        document.getElementById(
          "caWiASSUR"
        ).textContent = `${data.totalWiassur.toLocaleString()} FCFA`;

        document
          .querySelector(".water_wave")
          .style.setProperty("--top-wafa", `${100 - pourcentageWafa}%`);
        document
          .querySelector(".water_wave2")
          .style.setProperty("--top-wiassur", `${100 - pourcentageWiassur}%`);
      }

      function createDynamicKeyframes(id, pourcentageTop) {
        const styleSheet = document.styleSheets[0];
        const keyframes = `
        @keyframes ${id} {
          0% { transform: translate(-50%,50%) rotate(0deg); top: -${
            pourcentageTop - 5
          }% }
          50% { top: -${pourcentageTop}% }
          100% { transform: translate(-50%,50%) rotate(360deg); top: -${
            pourcentageTop - 5
          }% }
        }`;

        // Ajoute l'animation aux styles de la page
        dynamicStyleSheet.sheet.insertRule(
          keyframes,
          dynamicStyleSheet.sheet.cssRules.length
        );
      }



function updateCountdown() {
  const now = new Date();
  const newYear = new Date(now.getFullYear() + 1, 0, 1);
  const timeDifference = newYear - now;

  const days = Math.floor(timeDifference / (1000 * 60 * 60 * 24));
  const hours = Math.floor((timeDifference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
  const minutes = Math.floor((timeDifference % (1000 * 60 * 60)) / (1000 * 60));
  const seconds = Math.floor((timeDifference % (1000 * 60)) / 1000);

  document.getElementById('countdown').innerHTML = 
      `Il nous reste ${days} jours, ${hours} heures, ${minutes} minutes, ${seconds} secondes avant la fin de l'annÃ©e COURAGE ðŸ’ªðŸ¦¾ !!!`;

  if (timeDifference < 0) {
      document.getElementById('countdown').innerHTML = "Bonne annÃ©e !";
  }
}

setInterval(updateCountdown, 1000);

function maFonction() {
  console.log("La fonction s'exÃ©cute !");
  
fetch('https://script.google.com/macros/s/AKfycbzRy4KzJ6AvL8mnOcUi9_qbPACSG-XjS-upBAWOfB-I0wZNsP7ul_rnAj08b7_zGa2A2A/exec')
.then(response => {
  if (!response.ok) {
    throw new Error('Erreur dans la rÃ©ponse du rÃ©seau');
  }
  return response.json(); // Convertir la rÃ©ponse en JSON
})
.then(data => {
  console.log('DonnÃ©es reÃ§ues :', data); // Afficher les donnÃ©es dans la console
  if (data && data[0]) {
    remplirProgression(data[0]); // Appelle avec les donnÃ©es API
  }
})
.catch(error => {
  console.error('Il y a eu un problÃ¨me avec la requÃªte fetch :', error);
});


}

function verifierEtExecuter() {
  const maintenant = new Date();
  const heure = maintenant.getHours();
  const minutes = maintenant.getMinutes();
  
  // VÃ©rifie s'il est exactement 8h00 ou 18h00
  if ((heure === 8 || heure === 18) && minutes === 0) {
      maFonction();
  }
}

setInterval(verifierEtExecuter, 60000);

maFonction()

    </script>
  </body>
</html>
